<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ASCII Names</title>
  <link rel="stylesheet" type="text/css" href="app.css">
  <script language="JavaScript">

  var asciiCode;
  var asciiString = [];

  function listPreviousNames() {
     var histList=document.getElementById('history');
     histList.innerHTML='';
     hList=localStorage['history'].split(':');
     for (var i=0; i<hList.length; i++) {
     	var name=hList[i];
	var addThis="<p>"+name+"</p>";
	histList.innerHTML = histList.innerHTML + addThis;
     }

  }
  function addName() {
     var readableName=document.getElementById('preview').innerHTML;
     var codeName=document.getElementById('fNew').value;
     if(codeName==="clear all") {
     	 localStorage['history']='';
     } else {
	 newString=asciiString.join(' ')+" - "+readableName;
	 localStorage['history'] = localStorage['history']+":"+newString;
     }
     document.getElementById('fNew').value='';
     asciiString.length=0;
     asciiCode='';
     
  }
  function submitenter(myfield, e) {
     var keycode;
     var p=document.getElementById('preview');
     if (window.event) keycode = window.event.keyCode;
     else if (e) keycode = e.which;
     else return true;
     if (keycode == 13) {
        // Enter key submits the new name
	addName();
	listPreviousNames();
	p.innerHTML='';
        return false;
     } else if (keycode == 8) {
        // Backspace or delete
	if(asciiCode.length==0) {
	    // Remove the previous character from preview and
	    //  the asciiString stack
	    p.innerHTML=p.innerHTML.slice(0, -1);
	    if(asciiString.length>0) {
	        asciiCode=asciiString.pop().slice(0, -1);
	    } else {
	        asciiCode='';
	    }
	} else {
	    // Remove the last character from an incomplete code
	    asciiCode=asciiCode.slice(0, -1);
	}
     } else {
        // Process ASCII values entered as decimal
	asciiCode=asciiCode+String.fromCharCode(keycode);
	var decValue=parseInt(asciiCode);
	if (decValue>=32) {
	    p.innerHTML=p.innerHTML + String.fromCharCode(decValue);
	    asciiString.push(asciiCode);
	    asciiCode='';
	}
     }
     // DEBUGGING code
     //document.getElementById('show').innerHTML=asciiCode;
     return true;
  }
  function StartPage() {
      asciiCode='';
      listPreviousNames();
      // FIXME
      localStorage['history']='';
  }

  </script>
</head>
<body onLoad="StartPage()">
<div id="container">
<b>Previous names:</b><br/>
<div id="history">

</div>

<div id="entry">
<div id="preview">
</div>

<form id="entryForm" action="#" method="post"
  onkeypress="return submitenter(this, event)">
<b>Enter your name:</b> <br/><br/>
<input type="text" name="newName" id="fNew" />
<br/>
<br/>
</form>
<div id="show">
</div>

</div>

</div> <!-- container -->
</body>
</html>

